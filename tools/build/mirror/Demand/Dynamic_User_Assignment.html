<a id="top"></a>

						<div class="mw-indicators">
</div>
			<h1 id="firstHeading" class="firstHeading" lang="en">Demand/Dynamic User Assignment</h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Sumo</div>
								<div id="contentSub"></div>
												
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Iterative_Assignment_.28Dynamic_User_Equilibrium.29"><span class="tocnumber">2</span> <span class="toctext">Iterative Assignment (<b>D</b>ynamic <b>U</b>ser <b>E</b>quilibrium)</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Route-Choice_algorithm"><span class="tocnumber">2.1</span> <span class="toctext">Route-Choice algorithm</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Gawron_.28default.29"><span class="tocnumber">2.1.1</span> <span class="toctext">Gawron (default)</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Logit"><span class="tocnumber">2.1.2</span> <span class="toctext">Logit</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="#Termination"><span class="tocnumber">2.2</span> <span class="toctext">Termination</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Usage_Examples"><span class="tocnumber">2.3</span> <span class="toctext">Usage Examples</span></a>
<ul>
<li class="toclevel-3 tocsection-8"><a href="#Loading_vehicle_types_from_an_additional_file"><span class="tocnumber">2.3.1</span> <span class="toctext">Loading vehicle types from an additional file</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="#oneShot-assignment"><span class="tocnumber">3</span> <span class="toctext">oneShot-assignment</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#MAROUTER"><span class="tocnumber">4</span> <span class="toctext">MAROUTER</span></a></li>
</ul>
</div>

<h1><span class="mw-headline" id="Introduction">Introduction</span></h1>
<p>For a given set of vehicles with of origin-destination relations (trips), the simulation must determine routes through the network (list of edges) that are used to reach the destination from the origin edge. The simplest method to find these routes is by computing shortest or fastest routes through the network using a routing algorithm such as Djikstra or A*. These algorithms require assumptions regarding the travel time for each network edge which is commonly not known before running the simulation due to the fact that travel times depend on the number of vehicles in the network.
</p>
<div style="background: #ffcc44; padding: .5em; border: 1px dashed #ff8800; margin-right:10px; margin-left:10px;"><b>Caution:</b><br />A frequent problem with naive user assignment is that all vehicles take the fastest path under the assumption that they are alone in the network and are then jammed at bottlenecks due to the sheer amount of traffic.</div>.
<p>The problem of determining suitable routes that take into account travel times in a traffic-loaded network is called <i>user assignment</i>.
SUMO provides different tools to solve this problem and they are described below.
</p>
<h1><span class="mw-headline" id="Iterative_Assignment_.28Dynamic_User_Equilibrium.29">Iterative Assignment (<b>D</b>ynamic <b>U</b>ser <b>E</b>quilibrium)</span></h1>
<p>The tool <i> </i><b>&lt;SUMO_HOME&gt;</b><i>/tools/assign/duaIterate.py </i> can be used to compute the (approximate) dynamic user equilibrium.
</p>
<div style="background: #ffcc44; padding: .5em; border: 1px dashed #ff8800; margin-right:10px; margin-left:10px;"><b>Caution:</b><br />This script will require copious amounts of disk space</div>
<pre>python duaIterate.py -n <i><b>&lt;network-file&gt;</b></i> -t <i><b>&lt;trip-file&gt;</b></i> -l <i><b>&lt;nr-of-iterations&gt;</b></i>
</pre>
<p><i>duaIterate.py</i> supports many of the same options as <a href="../SUMO.html" title="SUMO">SUMO</a>. Any options not listed when calling <i>duaIterate.py <span style="color: #111144; font-weight: bold; white-space: pre;">--help</span></i> can be passed to <a href="../SUMO.html" title="SUMO">SUMO</a> by adding <span style="color: #111144; font-weight: bold; white-space: pre;">sumo--long-option-name arg</span> after the regular options (i.e. <span style="color: #111144; font-weight: bold; white-space: pre;">sumo--step-length 0.5</span>.
</p><p><br />
This script tries to calculate a user equilibrium, that is, it tries to find a route for each vehicle (each trip from the trip-file above) such that each vehicle cannot reduce its travel cost (usually the travel time) by using a different route. It does so iteratively (hence the name) by 
</p>
<ol><li>  calling <a href="../DUAROUTER.html" title="DUAROUTER">DUAROUTER</a> to route the vehicles in a network with the last known edge costs (starting with empty-network travel times) </li>
<li> calling <a href="../SUMO.html" title="SUMO">SUMO</a> to simulate "real" travel times result from the calculated routes. The result edge costs are used in the net routing step.</li></ol>
<p>The number of iterations may be set to a fixed number of determined dynamically depending on the used options. In order to ensure convergence there are different methods employed to calculate the route choice probability from the route cost (so the vehicle does not always choose the "cheapest" route). In general, new routes will be added by the router to the route set of each vehicle in each iteration (at least if none of the present routes is the "cheapest") and may be chosen according to the route choice mechanisms described below.
</p><p>Between successive calls of DUAROUTER, the <i>.rou.alt.xml</i> format is used to record not only the current <i>best</i> route but also previously computed alternative routes. These routes are collected within a route distribution and used when deciding the actual route to drive in the next simulation step. This isn't always the one with the currently lowest cost but is rather sampled from the distribution of alternative routes by a configurable algorithm described below.
</p>
<h2><span class="mw-headline" id="Route-Choice_algorithm">Route-Choice algorithm</span></h2>
<p>The two methods which are implemented are called <a href="../Publications.html#Traffic_Assignment" title="Publications">Gawron</a> and <a rel="nofollow" class="external text" href="https://en.wikipedia.org/wiki/Discrete_choice">Logit</a> in the following. The input for each of the methods is a weight or cost function <img class="mwe-math-fallback-image-inline tex" alt="w" src="../images//f1290186a5d0b1ceab27f4e77c0c5d68.png" /> on the edges of the net, coming from the simulation or default costs (in the first step or for edges which have not been traveled yet), and a set of routes <img class="mwe-math-fallback-image-inline tex" alt="R" src="../images//e1e1d3d40573127e9ee0480caf1283d6.png" /> where each route <img class="mwe-math-fallback-image-inline tex" alt="r" src="../images//4b43b0aee35624cd95b910189b3dc231.png" /> has an old cost <img class="mwe-math-fallback-image-inline tex" alt="c_r" src="../images//e2fab861db6ea136b4b8c5dfd8685732.png" /> and an old probability <img class="mwe-math-fallback-image-inline tex" alt="p_r" src="../images//f100edd1ea934bf5d5548f98671ce34c.png" /> (from the last iteration) and needs a new cost <img class="mwe-math-fallback-image-inline tex" alt="c_r&#39;" src="../images//ccecafe99ceb2c86c43de2d96bfe4c04.png" /> and a new probability <img class="mwe-math-fallback-image-inline tex" alt="p_r&#39;" src="../images//a8184e1f26ab1ab622781c7d04416c0f.png" />.
</p>
<h3><span class="mw-headline" id="Gawron_.28default.29">Gawron (default)</span></h3>
<p>The Gawron algorithm computes probabilities for chosing from a set of alterantive routes for each driver. The following values are considered to compute these probabilities:
</p>
<ul><li> the travel time along the used route in the previous simulation step</li>
<li> the sum of edge travel times for a set of alternative routes</li>
<li> the previous probability of chosing a route</li></ul>
<h3><span class="mw-headline" id="Logit">Logit</span></h3>
<p>The Logit mechanism applies a fixed formula to each route to calculate the new probability. It ignores old costs and old probabilities and takes the route cost directly as the sum of the edge costs from the last simulation.
</p><p><img class="mwe-math-fallback-image-inline tex" alt="c_r&#39; = \sum_{e\in r}w(e)" src="../images//7ae9545228e01ad528baabeac052ebf6.png" />
</p><p>The probabilities are calculated from an exponential function with parameter <img class="mwe-math-fallback-image-inline tex" alt="\theta" src="../images//50d91f80cbb8feda1d10e167107ad1ff.png" /> scaled by the sum over all route values:
</p><p><img class="mwe-math-fallback-image-inline tex" alt="p_r&#39; = \frac{\exp(\theta c_r&#39;)}{\sum_{s\in R}\exp(\theta c_s&#39;)}" src="../images//e608182f575297573133d9a7c92f4950.png" />
</p><p><br />
</p>
<h2><span class="mw-headline" id="Termination">Termination</span></h2>
<p>The option <span style="color: #111144; font-weight: bold; white-space: pre;">--max-convergence-deviation</span> may be used to detect convergence and abort iterations automatically. Otherwise, a fixed number of iterations is used. Once the script finishes any of the resulting <i>.rou.xml</i> files may be used for simulation but the last one(s) should be the best.
</p>
<h2><span class="mw-headline" id="Usage_Examples">Usage Examples</span></h2>
<h3><span class="mw-headline" id="Loading_vehicle_types_from_an_additional_file">Loading vehicle types from an additional file</span></h3>
<p>By default, vehicle types are taken from the input trip file and are then propagated through <a href="../DUAROUTER.html" title="DUAROUTER">DUAROUTER</a> iterations (always as part of the written route file).
</p><p>In order to use vehicle type definitions from an <a href="../SUMO.html#Format_of_additional_files" title="SUMO"><i>additional-file</i></a>, further options must be set
</p>
<pre>duaIterate.py -n ... -t ... -l ... 
  --additional-file <i>&lt;FILE_WITH_VTYPES&gt;</i> 
  duarouter--aditional-file <i>&lt;FILE_WITH_VTYPES&gt;</i> 
  duarouter--vtype-output dummy.xml
</pre>
<p>Options preceeded by the string <i>duarouter--</i> are passed directly to duarouter and the option <i>vtype-output dummy.xml</i> must be used to prevent duplicate definition of vehicle types in the generated output files.
</p>
<h1><span class="mw-headline" id="oneShot-assignment">oneShot-assignment</span></h1>
<p>An alternative to the iterative user assignment above is incremental assignment. This happens automatically when using <span class="inlxml">&lt;trip&gt;</span> input directly in <a href="../SUMO.html" title="SUMO">SUMO</a> instead of <span class="inlxml">&lt;vehicle&gt;</span>s with pre-defined routes. In this case each vehicle will compute a fastest-path computation at the time of departure which prevents all vehicles from driving blindly into the same jam and works pretty well empirically (for larger scenarios). 
</p><p>The routes for this incremental assignment are computed using the <a href="../Demand/Automatic_Routing.html" title="Demand/Automatic Routing">Automatic Routing / Routing Device</a> mechanism. Since this device allows for various configuration options, the script <a href="../Tools/Assign.html#one-shot.py" title="Tools/Assign">Tools/Assign#one-shot.py</a> may be used to automatically try different parameter settings.
</p>
<h1><span class="mw-headline" id="MAROUTER"><a href="../MAROUTER.html" title="MAROUTER">MAROUTER</a></span></h1>
<p>The <a href="../MAROUTER.html" title="MAROUTER">MAROUTER</a> application computes a <i>classic</i> macroscopic assignment. It employs mathematical functions (resistive functions) that approximate travel time increases when increasing flow. This allows to compute an iterative assignment without the need for time-consuming microscopic simulation.
</p>
<!-- 
NewPP limit report
CPU time usage: 0.044 seconds
Real time usage: 0.045 seconds
Preprocessor visited node count: 192/1000000
Preprocessor generated node count: 442/1000000
Post‐expand include size: 1070/2097152 bytes
Template argument size: 364/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   24.243      1 - -total
  8.86%    2.149      2 - Template:Caution
  8.65%    2.097      4 - Template:Option
  6.95%    1.684      2 - Template:XML
  6.81%    1.650      1 - Template:SUMO
  5.81%    1.409      1 - Template:AdditionalFile
-->

<!-- Saved in parser cache with key sumoSimWiki:pcache:idhash:352-0!*!0!!en!*!*!math=0 and timestamp 20181010111712 and revision id 10603
 -->
</div>									</div><hr/><div id="lastmod">This page was last modified on 12 February 2018, at 15:02.</div>