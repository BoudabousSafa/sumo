<a id="top"></a>

						<div class="mw-indicators">
</div>
			<h1 id="firstHeading" class="firstHeading" lang="en">Demand/Routes from Observation Points</h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Sumo</div>
								<div id="contentSub"></div>
												
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>Since version 0.9.5, the SUMO-package contains a routing module named <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a>. The idea behind this router is that nowadays, most highways are well equipped with induction loops, measuring each of the highways' entering and leaving flows. Given this information one may assume that the flows on the highway are completely known. <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> uses directly the information collected from induction loops to rebuild the vehicle amounts and routes. This is done in several steps, being mainly:
</p>
<ol><li> Computing (and optionally saving) the detector types in the means that each induction is set to be a source detector, a sink detector or an in-between detector</li>
<li> Computing (and optionally saving) the routes between the detectors</li>
<li> Computing the flow amounts between the detectors</li>
<li> Saving the flow amounts and further control structures</li></ol>
<div style="background: #ffcc44; padding: .5em; border: 1px dashed #ff8800; margin-right:10px; margin-left:10px;"><b>Caution:</b><br />The <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> application has known deficiencies when used on highly meshed networks as found in cities. Alternatives are <a href="../Tools/Detector.html#flowrouter.py" title="Tools/Detector">the flowrouter tool</a> or <a href="../Simulation/Calibrator.html#Building_a_scenario_without_knowledge_of_routes.2C_based_on_flow_measurements" title="Simulation/Calibrator">dynamic calibration</a>.</div>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Computing_Detector_Types"><span class="tocnumber">1</span> <span class="toctext">Computing Detector Types</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Computing_Routes"><span class="tocnumber">2</span> <span class="toctext">Computing Routes</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Computing_Flows"><span class="tocnumber">3</span> <span class="toctext">Computing Flows</span></a>
<ul>
<li class="toclevel-2 tocsection-4"><a href="#Algorithm_Properties"><span class="tocnumber">3.1</span> <span class="toctext">Algorithm Properties</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Generating_Vehicles"><span class="tocnumber">4</span> <span class="toctext">Generating Vehicles</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Further_Outputs"><span class="tocnumber">5</span> <span class="toctext">Further Outputs</span></a>
<ul>
<li class="toclevel-2 tocsection-7"><a href="#Variable_Speed_Signs"><span class="tocnumber">5.1</span> <span class="toctext">Variable Speed Signs</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Rerouters"><span class="tocnumber">5.2</span> <span class="toctext">Rerouters</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Validation_Detectors"><span class="tocnumber">5.3</span> <span class="toctext">Validation Detectors</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-10"><a href="#How_to_include_the_files"><span class="tocnumber">6</span> <span class="toctext">How to include the files</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Computing_Detector_Types">Computing Detector Types</span></h2>
<p>The idea behind the <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> assumes that a network is completely covered by detectors, meaning that all off- and on-ramps have an induction loop placed on them. Such an information whether an induction loop is a pure source or sink or whether it is placed between such is but not given initially. It must be computed. To do this, the <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> needs the underlying network as well as a list of detector definitions where each describes the position of an induction loop. The network, being a previously built SUMO-network, is supplied to the <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> as usual using the <span style="color: #111144; font-weight: bold; white-space: pre;">--net-file &lt;SUMO_NET_FILE&gt;</span> (<span style="color: #111144; font-weight: bold; white-space: pre;">-n</span>) option, the list of induction loops using <span style="color: #111144; font-weight: bold; white-space: pre;">--detector-files &lt;DETECTOR_FILE&gt;[,&lt;DETECTOR_FILE&gt;]+</span> (<span style="color: #111144; font-weight: bold; white-space: pre;">-d</span> for short). A detector file should look as follows:
</p>
<pre class="xml">
&lt;detectors&gt;
   &lt;detectorDefinition id=&quot;&lt;DETECTOR_ID&gt;&quot; lane=&quot;&lt;LANE_ID&gt;&quot; pos=&quot;&lt;POS&gt;&quot;/&gt;
... further detectors ...
&lt;/detectors&gt;
</pre>
<p>This means that each detector is initially described using its id, a lane it is placed on, and a position on the lane. To be exact:
</p>
<ul><li> id: A string holding the id of the detector</li>
<li> lane: The id of the lane the detector lies on. Must be a lane within the network.</li>
<li> pos: The position on the lane the detector shall be laid on in meters. The position must be a value between -1*lane's length and the lane's length. In the case of a negative value, the position will be computed backward from the lane's end (the position the vehicles drive towards).</li></ul>
<p>Given a network and the list of detectors, <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> assigns types to detectors and saves the so extended list into a file if the option <span style="color: #111144; font-weight: bold; white-space: pre;">--detectors-output &lt;DETECTOR_OUTPUT_FILE&gt;</span> is given. This list looks like the input described above except that an aditional attribute is given for each detector, "type", which may have one of the following values: "source", "sink", "between", and "discarded". You can also generate a list of points of interests (POIs) which can be read by <a href="../SUMO-GUI.html" title="SUMO-GUI">SUMO-GUI</a> where each POI represents a detector and is colored by the detector type: green for source detectors, red for sink detectors, blue for in-between detectors, and black for discarded detectors. To force <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> to do this, use <span style="color: #111144; font-weight: bold; white-space: pre;">--detectors-poi-output &lt;POI_FILENAME&gt;</span>.
</p><p>When wished, if for example other parameters chage, the extended &lt;DETECTOR_OUTPUT_FILE&gt; can be fed back again into <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> instead of the previous &lt;DETECTOR_FILE&gt;. In this case the detector types do not have to be computed again. To force <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> to recompute the types, use <span style="color: #111144; font-weight: bold; white-space: pre;">--revalidate-detectors</span>.
</p>
<h2><span class="mw-headline" id="Computing_Routes">Computing Routes</span></h2>
<p>Now that we do know where vehicles enter and where they leave the network, we may compute routes for each of the pairs. The <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> is told to build and save routes using <span style="color: #111144; font-weight: bold; white-space: pre;">--routes-output &lt;ROUTE_OUTPUT_FILE&gt;</span> where &lt;ROUTE_OUTPUT_FILE&gt; is the name of the file the computed routes shall be written to. The generated file only contains routes, no vehicle type definitions and no vehicles. 
</p><p>Normally, only routes starting at source detectors and ending at sink detectors are computed. Using the option <span style="color: #111144; font-weight: bold; white-space: pre;">--routes-for-all</span> you can force <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> to also build routes that start at in-between detectors. The option <span style="color: #111144; font-weight: bold; white-space: pre;">--all-end-follower</span> will make the routes not end at the edge the source detector is placed on, but on all edges that follow this edge. <span style="color: #111144; font-weight: bold; white-space: pre;">--keep-unfinished-routes</span> will also keep those routes where a sink detector could not be found for what may be the case if the network is not completely covered with induction loops.
</p>
<h2><span class="mw-headline" id="Computing_Flows">Computing Flows</span></h2>
<p>The next step is to use the computed routes and flow amounts from the real-world detectors to compute flows across the modelled network. The flows are given to DFROUTER using <span style="color: #111144; font-weight: bold; white-space: pre;">--measure-files <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;STRING&gt;</i></a></span> (or <span style="color: #111144; font-weight: bold; white-space: pre;">-f &lt;DETECTOR_FLOWS&gt;[,&lt;DETECTOR_FLOWS&gt;]+</span>. They are assumed to be stored in CSV-format using ';' as dividing character. The file should look as follows:
</p>
<pre>Detector;Time;qPKW;qLKW;vPKW;vLKW
myDet1;0;10;2;100;80
... further entries ...
</pre>
<p>This means the first time has to name the entries (columns). Their order is not of importance, but at least the following columns must be included:
</p>
<ul><li> Detector: A string holding the id of the detector this line describes; should be one of the ids used in &lt;DETECTOR_FILE&gt;</li>
<li> Time: The time period begin that this entry describes (in minutes)</li>
<li> qPKW: The number of passenger cars that drove over the detector within this time period</li>
<li> vPKW: The average speed of passenger cars that drove over the detector within this time period in km/h</li></ul>
<p>The following columns may optionally be included:
</p>
<ul><li> qLKW: The number of transport vehicles that drove over the detector within this time period</li>
<li> vLKW: The average speed of transport vehicles that drove over the detector within this time period in km/h</li></ul>
<p>These are not quite the values to be found in induction loop output. We had to constrain the &lt;DETECTOR_FLOWS&gt; files this way because DFROUTER is meant to read very many of such definitions and to do this as fast as possible.
</p><p>Because in some cases one reads detector flow definitions starting at a certain time but wants the simulation to begin at another, it is possible to add a time offset using <span style="color: #111144; font-weight: bold; white-space: pre;">--time-offset <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;INT&gt;</i></a></span> which is the number of seconds to subtracted from the read times.
</p>
<h3><span class="mw-headline" id="Algorithm_Properties">Algorithm Properties</span></h3>
<p><a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> works best when all possible source and sink edges are supplied with detector values and these values are evenly spaced in time. 
The algorithm works under the assumption that the sum of source flows matches the sum of sink flows for every measurement interval (thus somewhat ignoring travel time).
Some properties of <a href="#Generating_Vehicles">Vehicle generation</a>:
</p>
<ul><li> The number of generated vehicles for each measurement interval is determined by source detectors alone. 
<ul><li> Excess flow at sink detectors is ignored</li>
<li> If sink detectors measure less flow, it will nevertheless arrive there in proportion to the measured flow</li>
<li> If sink detectors measure no flow at all, all vehicles will drive to one (arbitrary) sink</li></ul></li></ul>
<p>The number of  will be determined by
</p>
<h2><span class="mw-headline" id="Generating_Vehicles">Generating Vehicles</span></h2>
<p>If flow definitions were supplied, we can let the DFROUTER save the computed vehicles together with their routes. Vehicles will be generated at the source detectors which are placed at certain positions of the networks' lanes. DFROUTER generates vehicle with the option <span style="color: #111144; font-weight: bold; white-space: pre;">--emitters-output &lt;EMITTER_OUTPUT_FILE&gt;</span>. This file will contain vehicle (emitter) declarations for each of the source detectors. If no value is given, vehicles will not be written. Accompanying, there will be <span class="inlxml">routeDistributions</span> each with the same name as a detector. These reflect the distribution of routes at the detector with the same ID.
</p><p>By default vehicles are inserted with even spacing over each measurement interval. This can be changed by adding the option <span style="color: #111144; font-weight: bold; white-space: pre;">--randomize-flows</span>.
</p><p>The generated file contains individual vehicles which are assigned routes from the <a href="#Computing_Routes">routes-output file</a>. 
</p>
<div style="background: #ffffdd; padding: .5em; border: 1px dashed #ffcc44; margin-right:10px; margin-left:10px;"><b>Note:</b><br />The emitters output also contains a <span class="inlxml">&lt;routeDistribution&gt;</span> for each source detector but this distribution is not used by the vehicles. It is generated for information purposes and shows the route distribution aggregated over the whole simulation time (this distribution assumes that source flows data matches sink flow data).</div>
<h2><span class="mw-headline" id="Further_Outputs">Further Outputs</span></h2>
<h3><span class="mw-headline" id="Variable_Speed_Signs">Variable Speed Signs</span></h3>
<p>As some approaches use a speed limit to avoid open-end boundary problems, the DFROUTER can generate a list of speed triggers (see "Variable Speed Signs (VSS)") placed on the positions of sink detectors. The name to save the declaration of these speed triggers into is given using the option <span style="color: #111144; font-weight: bold; white-space: pre;">--variable-speed-sign-output &lt;VSS_OUTPUT_FILE&gt;</span>. The according variable speed sign definitions will be written into files named "vss_&lt;DETECTOR_ID&gt;.def.xml" where &lt;DETECTOR_ID&gt; is the name of the according sink detector.
</p>
<h3><span class="mw-headline" id="Rerouters">Rerouters</span></h3>
<p>In order not to end vehicle routes on off-ramps, it is possible to place rerouters (see "Rerouter") at the positions of the sink detectors, too. Giving the option <span style="color: #111144; font-weight: bold; white-space: pre;">--end-reroute-output &lt;REROUTER_OUTPUT_FILE&gt;</span> will generate a list of rerouter declarations. Please remark that in this case, no rerouter definitions are written, because the DFROUTER has no further information about possible routes beyond the area covered by the detectors.
</p>
<h3><span class="mw-headline" id="Validation_Detectors">Validation Detectors</span></h3>
<p>It's quite nice to have the possibility to check whether the simulation does what one wants. To validate whether the same flows are found within the simulation as within the reality, the option <span style="color: #111144; font-weight: bold; white-space: pre;">--validation-output &lt;SUMO_DETECTORS_OUTPUT&gt;</span> may be helpful. It generates a list of detector definitions (see "<a href="../Simulation/Output/Induction_Loops_Detectors_(E1).html" title="Simulation/Output/Induction Loops Detectors (E1)">inductive loop detectors</a>") placed at the positions of sink and in-between detectors. Their output will be saved into files named "validation_det_&lt;DETECTOR_ID&gt;.xml" and should be easily comparable to the detector flows previously fed to the router. The option <span style="color: #111144; font-weight: bold; white-space: pre;">--validation-output.add-sources</span> will let DFROUTER also build inductive loop detectors for source detectors which are place 1m behind the real-life detector's position.
</p>
<h2><span class="mw-headline" id="How_to_include_the_files">How to include the files</span></h2>
<p>The <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> is unique among the <b>SUMO</b>-routing applications in that it outputs routes and vehicles separately. <a href="../SUMO.html#Loading_order_of_input_files" title="SUMO">You need to make sure that the list of input files is in the correct order for resolving references</a>. Furthermore, <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> currently returns unsorted vehicles in its emitters-output. Assuming that <a href="../DFROUTER.html" title="DFROUTER">DFROUTER</a> was called with the options
</p>
<pre>dfrouter --net-file net.net.xml --routes-output routes.rou.xml --emitters-output vehicles.xml ...
</pre>
<p>SUMO must be called in the following way:
</p>
<pre> sumo --net-file net.net.xml --additional-files routes.rou.xml,emitters.rou.xml
</pre>
<p>If you run the tool <a href="../Tools/Routes.html#sort_routes.py" title="Tools/Routes">Tools/Routes#sort_routes.py</a> to sort the emitters, either of the following will work:
</p>
<pre> sumo --net-file net.net.xml --route-files routes.rou.xml,sorted_emitters.rou.xml
 sumo --net-file net.net.xml --route-files sorted_emitters.rou.xml --additional-files routes.rou.xml
</pre>
<!-- 
NewPP limit report
CPU time usage: 0.044 seconds
Real time usage: 0.044 seconds
Preprocessor visited node count: 218/1000000
Preprocessor generated node count: 588/1000000
Post‐expand include size: 3275/2097152 bytes
Template argument size: 1359/2097152 bytes
Highest expansion depth: 3/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   16.587      1 - -total
 40.36%    6.694     20 - Template:Option
 10.96%    1.818      2 - Template:XML
  9.22%    1.529      1 - Template:Note
  7.90%    1.310      1 - Template:Caution
  6.51%    1.080      1 - Template:DT_STR
  6.41%    1.063      1 - Template:DT_INT
-->

<!-- Saved in parser cache with key sumoSimWiki:pcache:idhash:230-0!*!0!!en!*!* and timestamp 20181010222101 and revision id 9674
 -->
</div>									</div><hr/><div id="lastmod">This page was last modified on 15 June 2017, at 09:43.</div>