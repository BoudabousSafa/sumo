<a id="top"></a>

						<div class="mw-indicators">
</div>
			<h1 id="firstHeading" class="firstHeading" lang="en">Demand/Routing by Turn Probabilities</h1>
						<div id="bodyContent" class="mw-body-content">
									<div id="siteSub">From Sumo</div>
								<div id="contentSub"></div>
												
				<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><p>The <a href="../JTRROUTER.html" title="JTRROUTER">JTRROUTER</a> is a routing applications which uses flows and turning percentages at junctions as input. The following parameter must be supplied: 
</p>
<ul><li> the network to route the vehicles through,</li>
<li> the description of the turning ratios for the junctions (defaults may be used for this, too), and</li>
<li> the descriptions of the flows.</li></ul>
<p>A call may look like this:
</p>
<pre>jtrrouter --flow-files=&lt;FLOW_DEFS&gt; --turn-ratio-files=&lt;TURN_DEFINITIONS&gt; --net-file=&lt;SUMO_NET&gt; \
  --output-file=MySUMORoutes.rou.xml --begin &lt;UINT&gt; --end &lt;UINT&gt;
</pre>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Turn_Definitions"><span class="tocnumber">1</span> <span class="toctext">Turn Definitions</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Automatic_generation_of_turn_definitions"><span class="tocnumber">1.1</span> <span class="toctext">Automatic generation of turn definitions</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-3"><a href="#Sinks_Definitions"><span class="tocnumber">2</span> <span class="toctext">Sinks Definitions</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Flow_Definitions"><span class="tocnumber">3</span> <span class="toctext">Flow Definitions</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Additional_Options"><span class="tocnumber">4</span> <span class="toctext">Additional Options</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Turn_Definitions">Turn Definitions</span></h2>
<table class="wikitable" style="width:25em; border-width:1px 1px; border-style:solid; border-color:#909090; background-color:#f8f8ff; font-size:90%; margin:1em 0em 1em 2em; padding:3px 6px">
<caption> <b>Turn and Sink Definitions</b>
</caption>
<tr>
<td width="45%"> Filename extension </td>
<td> .turns.xml
</td></tr>
<tr>
<td> Type of content </td>
<td> turn and sink definitions
</td></tr>
<tr>
<td> Open format? </td>
<td> Yes
</td></tr>
<tr>
<td> SUMO specific? </td>
<td> Yes
</td></tr>
<tr>
<td> XML Schema
</td>
<td> <a rel="nofollow" class="external text" href="http://sumo.sf.net/doc/current/docs/xsd/turns_file.xsd">turns_file.xsd</a>
</td></tr></table>
<p>To describe the turn definitions, one has to write an XML file. Within this file, for each interval and each edge the list of percentages to use a certain follower edge has to be given. An example:
</p>
<pre class="xml">
&lt;turns&gt;
   &lt;interval begin=&quot;0&quot; end=&quot;3600&quot;&gt;
      &lt;fromEdge id=&quot;myEdge0&quot;&gt;
         &lt;toEdge id=&quot;myEdge1&quot; probability=&quot;0.2&quot;/&gt;
         &lt;toEdge id=&quot;myEdge2&quot; probability=&quot;0.7&quot;/&gt;
         &lt;toEdge id=&quot;myEdge3&quot; probability=&quot;0.1&quot;/&gt;
      &lt;/fromEdge&gt;

      ... any other edges ...

   &lt;/interval&gt;

   ... some further intervals ...

&lt;/turns&gt;
</pre>
<div style="background: #ffffdd; padding: .5em; border: 1px dashed #ffcc44; margin-right:10px; margin-left:10px;"><b>Note:</b><br />If you provide turn definitions that overlap (for example in multiple files), the latter turn definition will override the former.</div>
<p>The snippet defines that vehicles coming at the end of edge "<span class="inlxml">myEdge0</span>" within the time interval between 0s and 3600s will choose the edge "<span class="inlxml">myEdge1</span>" with a probability of 20%, "<span class="inlxml">myEdge2</span>" with a probability of 70% and "<span class="inlxml">myEdge3</span>" with a probability of 10%. Another possibility to save time on preparing the description is to use default values. The parameter <span style="color: #111144; font-weight: bold; white-space: pre;">--turn-defaults (-T) &lt;TURN_DEFAULTS&gt;</span> can be used to describe the default ratios that will be used for all junctions for all time steps. &lt;TURN_DEFAULTS&gt; is a list of doubles, separated by a ','. To achieve the same behaviour as in the example above, use <span style="color: #111144; font-weight: bold; white-space: pre;">--turn-defaults 20,70,10</span>. The values will be applied to an edge's following edges beginning at the right edge (20%) and ending at the leftmost edge (10%). As the number of possible followers changes for different edges, the values are resampled for edges which number of following edges differs from the number of given turning probability defaults. Given <span style="color: #111144; font-weight: bold; white-space: pre;">--turn-defaults 20,70,10</span> a vehicle using an edge that has two followers would use the follower to the right with 55% probability, the one to the left with 45%.
</p><p><br />
</p>
<h3><span class="mw-headline" id="Automatic_generation_of_turn_definitions">Automatic generation of turn definitions</span></h3>
<p>For automatic, yet artificial, turn definitions generation based on the network structure, see <a href="../Tools/Misc.html#generateTurnDefs.py" title="Tools/Misc">generateTurnDefs.py</a>.
</p>
<h2><span class="mw-headline" id="Sinks_Definitions">Sinks Definitions</span></h2>
<p>A vehicle leaves the network as soon as it comes to a sink edge. As not all networks have sink edges defined, one can support a list of edges to be declared as sinks using <span style="color: #111144; font-weight: bold; white-space: pre;">--sinks &lt;EDGE_ID&gt;[,&lt;EDGE_ID&gt;]*</span>. You may also add your sink definitions to a turn-file (XML only):
</p>
<pre class="xml">
&lt;turns&gt;
   ... some further turning definitions as above ...
 
   &lt;sink edges=&quot;&lt;EDGE_ID&gt;[ &lt;EDGE_ID&gt;]*&quot;/&gt;
   ... further sink definitions ...

&lt;/turns&gt;
</pre>
<p>If you do not define sinks, the option <span style="color: #111144; font-weight: bold; white-space: pre;">--accept-all-destinations <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;BOOL&gt;</i></a></span> may be used to declare all edge as possible sinks.
</p>
<h2><span class="mw-headline" id="Flow_Definitions">Flow Definitions</span></h2>
<p>The <a href="../Definition_of_Vehicles,_Vehicle_Types,_and_Routes.html#Repeated_vehicles_.28Flows.29" title="Definition of Vehicles, Vehicle Types, and Routes">definitions of the flow</a> is the same as for the <a href="../DUAROUTER.html" title="DUAROUTER">DUAROUTER</a> with just a single difference: as it is not known where the vehicle will leave the network as the route it uses is randomly computed, the route must be specified using attribute <i>from</i> and attribute <i>to</i> must be omitted:
</p>
<pre> &lt;flow id="0" from="A" begin="0" end="3600" probability="0.5"/&gt;
</pre>
<h2><span class="mw-headline" id="Additional_Options">Additional Options</span></h2>
<p>As theoretically a route may get infinitely long when a vehicle is forced to take always the same direction, it is possible to limit the route's size using optoin <span style="color: #111144; font-weight: bold; white-space: pre;"> --max-edges-factor <a href="../Basics/Notation.html#Referenced_Data_Types" title="Basics/Notation"><i>&lt;FLOAT&gt;</i></a></span>. This factor, multiplied with the number of the used network's edges is the maximum number of edges a route may have. With the default of 2.0, a route may contain twice as many edges as the network has. Any route longer than this size will be marked as invalid. We assume that for each network this number has to be chosen again.
</p>
<!-- 
NewPP limit report
CPU time usage: 0.028 seconds
Real time usage: 0.031 seconds
Preprocessor visited node count: 133/1000000
Preprocessor generated node count: 476/1000000
Post‐expand include size: 1643/2097152 bytes
Template argument size: 765/2097152 bytes
Highest expansion depth: 5/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   14.294      1 - -total
 36.75%    5.253      1 - Template:Infobox_file_format
 36.07%    5.156      6 - Template:Option
 16.37%    2.340      2 - Template:Ifdef
  9.30%    1.330      1 - Template:DT_BOOL
  9.22%    1.318      1 - Template:DT_FLOAT
  7.97%    1.139      1 - Template:Note
-->

<!-- Saved in parser cache with key sumoSimWiki:pcache:idhash:229-0!*!0!!en!*!* and timestamp 20181010142426 and revision id 10414
 -->
</div>									</div><hr/><div id="lastmod">This page was last modified on 16 December 2017, at 01:21.</div>